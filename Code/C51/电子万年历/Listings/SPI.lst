C51 COMPILER V9.60.0.0   SPI                                                               06/26/2022 15:53:24 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE SPI
OBJECT MODULE PLACED IN .\Objects\SPI.obj
COMPILER INVOKED BY: D:\KeilMDKArm\C51\BIN\C51.EXE Hardware\SPI.c OMF2 OPTIMIZE(8,SPEED) BROWSE DEBUG PRINT(.\Listings\S
                    -PI.lst) TABS(2) OBJECT(.\Objects\SPI.obj)

line level    source

   1          #include ".\Library\STC15F.H"
   2          #include ".\Hardware\SPI.h"
   3          #define CPOL 0
   4          #define CPHA 0
   5          
   6          sbit SPI_CLK = P1^5;
   7          sbit SPI_MOSI = P1^3;
   8          sbit SPI_CS = P1^1;//拉低有效
   9          sbit SPI_MISO = P1^3;//记得改
  10          
  11          void SPI_Init()
  12          {
  13   1        SPI_CS = 0;
  14   1        SPI_MOSI = 1;
  15   1        #if CPOL==0
  16   1        SPI_CLK = 0;
  17   1        #else
                SPI_CLK =1 ;
                #endif
  20   1      }
  21          //模式0
  22          #if CPOL==0&&CPHA==0
  23          
  24          /**
  25            * @brief  模式0 写数据
  26            * @param  输入数据
  27            * @retval 无
  28            */
  29          
  30          void SPI_SendByte(unsigned char Dat)
  31          {
  32   1        unsigned char i;
  33   1        for(i = 0;i < 8;i++)
  34   1        {
  35   2          SPI_CLK = 0;
  36   2          if(Dat & 0x80)
  37   2            SPI_MOSI = 1;
  38   2          else
  39   2            SPI_MOSI = 0;
  40   2          Dat <<= 1;
  41   2          SPI_CLK = 1;
  42   2        }
  43   1        SPI_CLK = 0;
  44   1      }
  45          
  46          /**
  47            * @brief  模式0 读数据
  48            * @param  无
  49            * @retval 读取的数据
  50            */
  51          unsigned char SPI_ReadByte()
  52          {
  53   1        unsigned char i,Dat;
  54   1        
C51 COMPILER V9.60.0.0   SPI                                                               06/26/2022 15:53:24 PAGE 2   

  55   1        for(i = 0;i < 8;i ++)
  56   1        {
  57   2          SPI_CLK = 0;
  58   2          Dat <<= 1;
  59   2          if(SPI_MISO)
  60   2            Dat |= 0x01;
  61   2          else 
  62   2            Dat &= 0xfe;
  63   2          SPI_CLK = 1;
  64   2        }
  65   1        SPI_CLK = 0;
  66   1        return Dat;
  67   1      }
  68          #endif
  69          
  70          //模式1
  71          #if CPOL==0&&CPHA==1
              
              /**
                * @brief  模式1 写数据
                * @param  输入数据
                * @retval 无
                */
              void SPI_SendByte(unsigned char Dat)
              {
                unsigned char i;
                SPI_CLK = 0;
                for(i = 0;i < 8;i++)
                {
                  SPI_CLK = 1;
                  if(Dat & 0x80)
                    SPI_MOSI = 1;
                  else
                    SPI_MOSI = 0;
                  Dat <<= 1;
                  SPI_CLK = 0;
                }
              }
              
              /**
                * @brief  模式1 读数据
                * @param  无
                * @retval 读取的数据
                */
              unsigned char SPI_ReadByte()
              {
                unsigned char i,Dat;
                
                for(i = 0;i < 8;i ++)
                {
                  SPI_CLK = 1;
                  Dat <<= 1;
                  if(SPI_MISO)
                    Dat |= 0x01;
                  else 
                    Dat &= 0xfe;
                  SPI_CLK = 0;
                }
                SPI_CLK = 0;
                return Dat;
              }
              #endif
C51 COMPILER V9.60.0.0   SPI                                                               06/26/2022 15:53:24 PAGE 3   

 117          
 118          
 119          //模式2
 120          #if CPOL==1&&CPHA==0
              
              /**
                * @brief  模式2 写数据
                * @param  输入数据
                * @retval 无
                */
              void SPI_SendByte(unsigned char Dat)
              {
                unsigned char i;
                for(i = 0;i < 8;i++)
                {
                  SPI_CLK = 1;
                  if(Dat & 0x80)
                    SPI_MOSI = 1;
                  else
                    SPI_MOSI = 0;
                  Dat <<= 1;
                  SPI_CLK = 0;
                }
                SPI_CLK = 1;
              }
              
              /**
                * @brief  模式2 读数据
                * @param  无
                * @retval 读取的数据
                */
              unsigned char SPI_ReadByte()
              {
                unsigned char i,Dat;
                
                for(i = 0;i < 8;i ++)
                {
                  SPI_CLK = 1;
                  Dat <<= 1;
                  if(SPI_MISO)
                    Dat |= 0x01;
                  else 
                    Dat &= 0xfe;
                  SPI_CLK = 0;
                }
                SPI_CLK = 1;
                return Dat;
              }
              #endif
 166          //模式3
 167          #if CPOL==1&&CPHA==1
              
              /**
                * @brief  模式3 写数据
                * @param  输入数据
                * @retval 无
                */
              void SPI_SendByte(unsigned char Dat)
              {
                unsigned char i;
                SPI_CLK = 1;
                for(i = 0;i < 8;i++)
C51 COMPILER V9.60.0.0   SPI                                                               06/26/2022 15:53:24 PAGE 4   

                {
                  SPI_CLK = 0;
                  if(Dat & 0x80)
                    SPI_MOSI = 1;
                  else
                    SPI_MOSI = 0;
                  Dat <<= 1;
                  SPI_CLK = 1;
                }
              }
              
              /**
                * @brief  模式3 读数据
                * @param  无
                * @retval 读取的数据
                */
              unsigned char SPI_ReadByte()
              {
                unsigned char i,Dat;
                
                SPI_CLK = 0;
                for(i = 0;i < 8;i ++)
                {
                  SPI_CLK = 0;
                  Dat <<= 1;
                  if(SPI_MISO)
                    Dat |= 0x01;
                  else 
                    Dat &= 0xfe;
                  SPI_CLK = 1;
                }
                SPI_CLK = 1;
                return Dat;
              }
              #endif
 214          
 215          
 216          
 217          
 218          
 219          
 220          
 221          
 222          
 223          
 224          
 225          
 226          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     80    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
C51 COMPILER V9.60.0.0   SPI                                                               06/26/2022 15:53:24 PAGE 5   

END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
