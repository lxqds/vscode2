C51 COMPILER V9.60.0.0   DHT11                                                             06/26/2022 14:20:14 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE DHT11
OBJECT MODULE PLACED IN .\Objects\DHT11.obj
COMPILER INVOKED BY: D:\KeilMDKArm\C51\BIN\C51.EXE Hardware\DHT11.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\
                    -Listings\DHT11.lst) TABS(2) OBJECT(.\Objects\DHT11.obj)

line level    source

   1          #include <STC15F2K60S2.H>
*** WARNING C318 IN LINE 1 OF Hardware\DHT11.c: can't open file 'STC15F2K60S2.H'
   2          #include <Delay.h>
*** WARNING C318 IN LINE 2 OF Hardware\DHT11.c: can't open file 'Delay.h'
   3          #include "oled.h"
*** WARNING C318 IN LINE 31 OF Hardware\oled.h: can't open file 'STC15F2K60S2.H'
*** ERROR C202 IN LINE 42 OF Hardware\oled.h: 'P1': undefined identifier
*** ERROR C202 IN LINE 43 OF Hardware\oled.h: 'P1': undefined identifier
*** ERROR C202 IN LINE 44 OF Hardware\oled.h: 'P4': undefined identifier
*** ERROR C202 IN LINE 45 OF Hardware\oled.h: 'P1': undefined identifier
*** ERROR C202 IN LINE 46 OF Hardware\oled.h: 'P1': undefined identifier
   4          #include "DHT11.h"
   5          sbit DHT11_DATA = P2^5;
*** ERROR C202 IN LINE 5 OF Hardware\DHT11.c: 'P2': undefined identifier
   6          //LED
   7          sbit LED = P4^0;
*** ERROR C202 IN LINE 7 OF Hardware\DHT11.c: 'P4': undefined identifier
   8          
   9          //复位
  10          void DHT_RST()
  11          {
  12   1        DHT11_DATA = 0;
*** ERROR C202 IN LINE 12 OF Hardware\DHT11.c: 'DHT11_DATA': undefined identifier
  13   1        Delay(20);
  14   1        DHT11_DATA =1;
  15   1        Delay30us();
  16   1      }
  17          
  18          /**
  19            * @brief  检测DHT是否存在
  20            * @param  无
  21            * @retval 1为不存在，0为存在
  22            */
  23          unsigned char DHT_Check()
  24          {
  25   1        unsigned char DHT_Flag = 0;
  26   1        while(DHT11_DATA && (DHT_Flag< 100))
  27   1        {
  28   2          DHT_Flag ++;
  29   2          Delay1us();
  30   2        };
  31   1        if(DHT_Flag >= 100) return 1;
  32   1        else DHT_Flag =0;
  33   1        while ((!DHT11_DATA)&&(DHT_Flag <100))
  34   1        {
  35   2          DHT_Flag ++;
  36   2          Delay1us();
  37   2        };
  38   1        if(DHT_Flag >= 100) return 1;
  39   1        return 0;
  40   1      }
  41          
  42          /**
  43            * @brief  从DHT1读取1个位
C51 COMPILER V9.60.0.0   DHT11                                                             06/26/2022 14:20:14 PAGE 2   

  44            * @param  无
  45            * @retval 返回0或1
  46            */
  47          unsigned char DHT_Read_Bit()
  48          {
  49   1        unsigned char DHT_Flag = 0;
  50   1        while(DHT11_DATA && (DHT_Flag< 100))
  51   1        {
  52   2          DHT_Flag ++;
  53   2          Delay1us();
  54   2        }
  55   1        DHT_Flag =0;
  56   1        while ((!DHT11_DATA)&&(DHT_Flag <100))
  57   1        {
  58   2          DHT_Flag ++;
  59   2          Delay1us();
  60   2        }
  61   1        Delay40us();
  62   1        if(DHT11_DATA)return 1;
  63   1        else return 0;
  64   1      }
  65          /**
  66            * @brief  从DHT1读取1个字节
  67            * @param  无
  68            * @retval 读到的数据
  69            */
  70          unsigned char DHT_Read_Byte()
  71          {
  72   1        unsigned char i,Dat;
  73   1        Dat = 0;
  74   1        for (i =0;i<8;i++)
  75   1        {
  76   2          Dat<<=1;
  77   2          Dat|=DHT_Read_Bit();
  78   2        }
  79   1        return Dat;
  80   1      }
  81          /**
  82            * @brief  从DHT读取一次数据
  83            * @param  温度值和湿度值
  84            * @retval 0为正常，1为失败
  85            */
  86          unsigned char DHT_Read_Data(unsigned char *Temp,unsigned char *Humi)
  87          {
  88   1        unsigned char Buff[5];
  89   1        unsigned char i;
  90   1        DHT11_DATA =1;
  91   1        DHT_RST();
  92   1        if(DHT_Check() == 0)
  93   1        {
  94   2          for (i = 0;i < 5;i++)
  95   2          {
  96   3              Buff[i]=DHT_Read_Byte();
  97   3          }
  98   2          DHT11_DATA =1;
  99   2      //    OLED_ShowNum(48,0,Buff[0],2,16);
 100   2      //    OLED_ShowNum(48,2,Buff[1],2,16);
 101   2      //    OLED_ShowNum(48,4,Buff[2],2,16);
 102   2      //    OLED_ShowNum(18,4,Buff[3],2,16);    
 103   2          if((Buff[0]+Buff[1]+Buff[2]+Buff[3])==Buff[4])
 104   2          {
 105   3            *Temp = Buff[2];
C51 COMPILER V9.60.0.0   DHT11                                                             06/26/2022 14:20:14 PAGE 3   

 106   3            *Humi = Buff[0];
 107   3      
 108   3          }
 109   2                
 110   2        } 
 111   1        else 
 112   1        {
 113   2          return 1;
 114   2        }
 115   1        
 116   1        return 0;
 117   1      }
 118          unsigned char DHT_Init()
 119          {
 120   1        DHT_RST();
 121   1        return DHT_Check();
 122   1      }
 123          
 124          void DHT_Display()
 125          {
 126   1        
 127   1        unsigned char T,H;
 128   1        LED = 1;
 129   1        if(Time_Update == 6)
 130   1        {
 131   2          DHT_Read_Data(&T,&H);
 132   2          OLED_ShowCHinese(56,6,15);//温
 133   2          OLED_ShowNum(72,6,T,2,16);
 134   2          OLED_ShowCHinese(96,6,16);//湿
 135   2          OLED_ShowNum(112,6,H,2,16);
 136   2        
 137   2        }
 138   1          
 139   1          
 140   1      }

C51 COMPILATION COMPLETE.  3 WARNING(S),  8 ERROR(S)
